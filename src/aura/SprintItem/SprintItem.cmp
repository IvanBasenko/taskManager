<!--
 - Created by Ivan Basenko on 15.11.2018.
 -->

<aura:component description="SprintItem" controller="TaskCardController"
                implements="flexipage:availableForAllPageTypes">
    <aura:attribute access="public" name="isExpanded" type="Boolean" default="false"/>
    <aura:attribute access="public" name="isStarted" type="Boolean" default="false"/>
    <aura:attribute access="public" name="sprint" type="Sprint__c"/>
    <aura:attribute name="isOpen" type="boolean" default="false"/>
    <aura:attribute access="public" name="sprintStatus" type="String"/>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler name="deleteTask" event="c:DeleteRecordEvt" action="{!c.handleDeleteTask}"/>
    <aura:handler name="showInfo" event="c:ShowInfoSprintEvt" action="{!c.handleShowInfo}"/>

    <div class="slds-card">
        <div class="slds-grid slds-gutters slds-p-around--medium slds-page-header__title">
            <div class="slds-col slds-text-heading--medium">{!v.sprint.Name}</div>
            <aura:if isTrue="{!v.isStarted}">
                <div class="slds-col slds-text-align_right">

                    <button onclick="{!c.startSprint}"
                            class="slds-button">
                        <lightning:icon iconName="utility:edit" size="small"
                                        alternativeText="Show"/>
                    </button>
                    <button onclick="{!c.startSprint}"
                            class="slds-button">
                        <lightning:icon iconName="utility:check" size="small"
                                        alternativeText="Show"/>
                    </button>

                </div>
                <aura:set attribute="else">
                    <div class="slds-col slds-text-align_right">
                        <lightning:button label="Start Sprint" variant="success" onclick="{!c.startSprint}"/>
                    </div>
                </aura:set>
            </aura:if>

        </div>
        <aura:if isTrue="{!v.isStarted}">
            <div class="slds-p-around--medium">
                <c:SprintProjView recordId="{!v.sprint.Id}"/>
            </div>
        </aura:if>
        <div id="expand-container">
            <div id="content" class="{!v.isExpanded ? 'slds-transition-show':'slds-transition-hide'}">
                <ui:scrollerWrapper class="sWrapTest slds-m-top--small">
                    <aura:if isTrue="{!not(empty(v.sprint.Tasks__r))}">
                        <lightning:layout verticalAlign="center" multipleRows="true">
                            <aura:iteration items="{!v.sprint.Tasks__r}" var="task">
                                <lightning:layoutItem flexibility="auto">
                                    <c:SprintCard taskCard="{!task}" sprintStatus="{!v.sprint.Status__c}"/>
                                </lightning:layoutItem>
                            </aura:iteration>
                        </lightning:layout>
                        <aura:set attribute="else">
                            <div class="slds-align_absolute-center slds-text-heading--large">No tasks found</div>
                        </aura:set>
                    </aura:if>
                </ui:scrollerWrapper>
            </div>
        </div>
        <div class="slds-border_top">
            <aura:if isTrue="{!!v.isExpanded}">
                <button onclick="{!c.changeState}"
                        class="slds-button">
                    <lightning:icon aura:id="articleOne" iconName="utility:chevrondown" size="small"
                                    alternativeText="Show"/>
                    <span class="slds-truncate" title="Section Title">Show {!v.sprint.Tasks__r.length} tasks</span>
                </button>
                <aura:set attribute="else">
                    <button onclick="{!c.changeState}"
                            class="slds-button">
                        <lightning:icon aura:id="articleOne" iconName="utility:chevronup" size="small"
                                        alternativeText="Hide"/>
                        <span class="slds-truncate" title="Section Title">Hide {!v.sprint.Tasks__r.length} tasks</span>
                    </button>
                </aura:set>
            </aura:if>
        </div>
    </div>
    <c:StartSprintModal isOpen="{!v.isOpen}" recordId="{!v.sprint.Id}"
                        taskCardList="{!v.sprint.Tasks__r}"/>
</aura:component>